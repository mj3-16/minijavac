plugins {
    id 'com.github.sherter.google-java-format' version '0.4.1'
}

apply plugin: 'application'
apply plugin: 'idea'
apply plugin: 'eclipse'

mainClassName = "minijava.Main"

// policy is to have a 'build' script; that requires us to have a non-default build directory
buildDir = 'build_dir'

test {
    //jvmArgs = ['-XX:+PrintCompilation']
}

repositories {
    mavenCentral()
    maven {
        url 'https://oss.sonatype.org/content/repositories/snapshots/'
    }
}

googleJavaFormat {
    toolVersion '1.2-SNAPSHOT'
}

dependencies {
    compile 'com.beust:jcommander:1.58'
    compile 'com.google.guava:guava:19.0'
    compile 'commons-io:commons-io:2.4'
    compile 'com.intellij:annotations:5.1'
    compile 'org.jooq:jool:0.9.9'
    compile 'org.slf4j:slf4j-nop:1.7.13'
    testCompile 'com.pholser:junit-quickcheck-core:0.6.1'
    testCompile 'com.pholser:junit-quickcheck-generators:0.6.1'
    testCompile 'junit:junit:4.12'
    testCompile 'org.hamcrest:hamcrest-library:1.3'
    testCompile 'com.google.jimfs:jimfs:1.1'
}

task syntaxTest(type: Exec) {
    workingDir './mjtest'
    commandLine 'python3', './mjt.py', 'syntax', '../run'
}

task astTest(type: Exec) {
    workingDir './mjtest'
    commandLine 'python3', './mjt.py', 'ast', '../run'
}

tasks.check.dependsOn syntaxTest
tasks.check.dependsOn astTest

tasks.test.dependsOn installDist
tasks.syntaxTest.dependsOn installDist
tasks.astTest.dependsOn installDist

task installGitHooks(type: Copy) {
    from file('git-hooks/pre-commit')
    into { file('.git/hooks') }
}
